---
title: 防止条件丢失
date: 2021-04-08 11:14:10
tags: os
---

 

### 条件丢失

{% asset_img campaign-6269159.jpg %}

<!--More-->

当signal发生在wait之前，就会丢失这次signal事件.

```c++
class Condition : public ConditionBase
{
public:
    Condition()
        : signal_(false)
    {
    }
 
    void wait()
    {
        pthread_mutex_lock(&mutex_);
        while (!signal_)
        {
            pthread_cond_wait(&cond_, &mutex_);
        }
        signal_ = false;
        pthread_mutex_unlock(&mutex_);
    }
 
    void wakeup()
    {
        pthread_mutex_lock(&mutex_);
        signal_ = true;
        pthread_cond_signal(&cond_);
        pthread_mutex_unlock(&mutex_);
    }
 
private:
    bool signal_;
};
```



